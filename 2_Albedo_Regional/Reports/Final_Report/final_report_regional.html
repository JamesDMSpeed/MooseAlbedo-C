<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title></title>

<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/paper.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>
<link href="libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="libs/highlightjs-9.12.0/highlight.js"></script>
<link href="libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="libs/pagedtable-1.1/js/pagedtable.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">



<!--Markdown HTML Report/Page Intro Section-->
<div class="intro-hdr">
	<div class="intro-hdr-inner">
		<h1>SatSkog Approach</h1>
	</div>
</div>

<div class="fluid-row" id="header">




</div>


<div id="overview" class="section level1">
<h1>Overview</h1>
<p>This report contains a summary of the 'SatSkog' approach, which uses a variety of spatial data to investigate the relationship between moose density and surface albedo in Norway.</p>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/Approach_SatSkog_Flowchart.png" />

</div>
<hr />
</div>
<div id="data" class="section level1">
<h1>Data</h1>
<div id="description" class="section level3 tabset tabset-fade tabset-pills">
<h3>Description</h3>
<div id="satskog-data-product" class="section level4">
<h4>SatSkog Data Product</h4>
<p>I decided to use NIBIO's <a href="https://www.nibio.no/tema/skog/kart-over-skogressurser/satskog">SatSkog</a> spatial forest data product for this analysis. NIBIO offers other (more recent) forest data products, but SatSkog is the only one in which the relative proportion of each major tree species (pine, spruce, and birch) is provided. These proportions are necessary to calculate &quot;composite albedo&quot; values (as described in other reports for this project) from the species-specific albedo values provided by the model developed by <a href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2018MS001403">Hu et al. (2018)</a>. Additionally, SatSkog was the data product on which the model developed by <a href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2018MS001403">Hu et al. (2018)</a> was trained.</p>
<p>SatSkog uses satellite photos and automated photogrammetric analysis to produce estimates for various forest parameters across Norway. The algorithms used in this photogrammetric analysis were developed and calibrated on field data from long-term forest plots managed by the Norwegian NFI. A majority of the satellite photos on which the SatSkog product is based upon were taken in 1999, but some regions of Norway were also photographed in 2007.</p>
<p>NIBIO provides an individual shapefile (with associated data) for each kommune in Norway. Contained within each shapefile is a number of polygons, each of which represents a plot of forest with associated parameters. I included all available shapefiles from NIBIO in my analysis, which totaled to <strong>342 kommunes in Norway</strong>.</p>
<p>More detailed information regarding the use and processing of SatSkog data in this approach is described below.</p>
</div>
<div id="senorge-climate-data" class="section level4">
<h4>seNorge Climate Data</h4>
<p>The albedo model developed by <a href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2018MS001403">Hu et al. (2018)</a> accepts <em>two climate parameters</em>: (1) monthly average snow-water equivalent (mm) and (2) monthly average temperature (K). seNorge provides this data across the entire country of Norway in the form of spatially-gridded daily estimates with a 1km2 resolution. I was able to obtain (very) large netCDF files with this gridded climate data across all of Norway for years of interest. I processed this data and created <strong>RasterBricks</strong> (with 12 layers of spatial data - 1 layer for each month) for each year of available seNorge data. Each layer contains spatially-gridded cells (1km2 resolution) with monthly averages of SWE (mm) and temperature (K).</p>
<p>The data is too large to fully present here, but I've provided an example of what a single month (January 1999) of plotted SWE data looks like (when using the raster package):</p>
<p><img src="final_report_regional_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
</div>
<div id="herbivore-densities" class="section level4 tabset">
<h4>Herbivore Densities</h4>
<p>Densities of various herbivores may have important effects on vegetation states within forest ecosystems, and therefore, it is likely prudent to control for relevant herbivore densities in our final analysis. In addition to forest species (such as moose, red deer, and roe deer), there are a number of other important herbivores that may affect vegetation and albedo in Norwegian boreal forests.</p>
<p><a href="https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0217166">Speed et al. (2019)</a> and <a href="https://bioone.org/journals/Wildlife-Biology/volume-17/issue-3/10-038/Spatio-temporal-variation-in-large-herbivore-pressure-in-Norway-during/10.2981/10-038.full">Austrheim et al. (2011)</a> calculated metabolic biomass (kg/km2) for many of these large herbivores in each Norwegian municipality (for 1949, 1959, 1969, 1979, 1989, 1999, 2009, and 2015). This allows us to (1) look at albedo as a function of moose density, and (2) control for other herbivore densities in our final model.</p>
<p>I've included plots of moose density (the main explanatory variable of interest) for both 1999 and 2009 data, which were both used in the analysis.</p>
<div id="section" class="section level5">
<h5>1999</h5>
<p><img src="final_report_regional_files/figure-html/unnamed-chunk-4-1.png" width="672" /><img src="final_report_regional_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
</div>
<div id="section-1" class="section level5">
<h5>2009</h5>
<p><img src="final_report_regional_files/figure-html/unnamed-chunk-5-1.png" width="672" /><img src="final_report_regional_files/figure-html/unnamed-chunk-5-2.png" width="672" /></p>
</div>
</div>
<div id="coordinate-reference-system-crs" class="section level4">
<h4>Coordinate Reference System (CRS)</h4>
<p>The default CRS of all SatSkog shapefiles was UTM33 - therefore, I decided to use UTM33 as my 'default' CRS, and projected all other spatial data (seNorge data + herbivore density data) to it.</p>
<hr />
</div>
</div>
</div>
<div id="processing-the-data" class="section level1">
<h1>Processing the Data</h1>
<p>I looped through all downloaded SatSkog shapefiles and processed them with the following steps:</p>
<div id="filtered-satskog-to-young-forest" class="section level5">
<h5>Filtered SatSkog to &quot;Young&quot; Forest</h5>
<p>Moose seem to be particularly important herbivores in early successional forest, and less so in mature forests. Therefore, I decided to subset all SatSkog data to &quot;young&quot; forest (Norwegian Hogstklasser 1-2, or age 1-30). All polygons in each shapefile that had an associated &quot;age&quot; value of greater than 30 years were removed from the dataset.</p>
</div>
<div id="extracted-swe-and-temperature-values" class="section level5">
<h5>Extracted SWE and Temperature Values</h5>
<p>Each polygon in a shapefile has an associated &quot;picture date&quot; - i.e. the date in which the corresponding satellite picture was taken. For each polygon, I used raster's &quot;extract&quot; function to extract relevant SWE and temperature data from the year corresponding to that polygon's &quot;picture date&quot;. I repeated this (for each polygon) across all months of the year. <strong>So, for example</strong>: if I had a polygon with a picture date in 1999, I extracted relevant SWE and temperature data recorded in 1999 for all months of the year.</p>
<p>If it wasn't possible to extract SWE and temperature for a polygon (as was the case for some polygons on outlying islands, where SWE and temperature measurements weren't available), that polygon was removed from the dataset.</p>
</div>
<div id="calculated-composite-albedo-for-remaining-polygons" class="section level5">
<h5>Calculated &quot;Composite&quot; Albedo for Remaining Polygons</h5>
<p>From the remaining polygons in a given shapefile, I used the associated volume measurement together with previously extracted SWE and temperature data to calculate species-specific albedo values for each polygon (across all months of the year). <strong>Note</strong>: The SatSkog volume parameter for each polygon was in m3/ha - therefore, to get a total volume measurement which could be used in the albedo model developed by <a href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1029/2018MS001403">Hu et al. (2018)</a>, I multiplied the m3/ha value for each polygon by the total area (ha) of that polygon.</p>
<p>I then used the approach described in other reports to produce &quot;composite albedo&quot; values for each polygon - I multiplied the &quot;fractional&quot; albedo values for each major species (pine, spruce, and birch) with corresponding percentages (obtained from SatSkog). I then summed these values to produce &quot;composite&quot; albedos. <strong>Thus, I ended up with 12 composite albedo values (one per month) for each polygon in a given shapefile</strong>.</p>
<p><span class="math display">\[C_{ij} = (A_{ij}S_{jk}) + (A_{ij}S_{jk}) + (A_{ij}S_{jk})\\\;\\C=composite\;albedo\\A = species\mbox{-}specific\;albedo\\S = species\;proportion\\i = month\;(1\mbox{-}12);\;j = polygon;\;k = species\;(spruce,\;pine,\;birch)\]</span></p>
</div>
<div id="joined-with-corresponding-herbivore-densities" class="section level5">
<h5>Joined With Corresponding Herbivore Densities</h5>
<p>For each remaining polygon, I used the associated SatSkog &quot;picture date&quot; (i.e. date of satellite picture) to choose the year of herbivore density data to include. I opted to use the year of herbivore data that was closest to the SatSkog &quot;picture date&quot;. <strong>So, for example:</strong> if a polygon had a picture date in 2002, it would be joined with herbivore data from 1999 (since 1999 is closer to 2002 than 2009). In contrast, if a polygon had a picture date in 2007, it would be joined with herbivore data from 2009 (since 2009 is closer than 1999).</p>
<p>Relevant herbivore density data was binded to existing polygon data using the st_join function.</p>
</div>
<div id="assigned-nas-to-erroneous-data" class="section level5">
<h5>Assigned &quot;NAs&quot; to Erroneous Data</h5>
<p>After looking at the SatSkog field manual, I realized that there were quite a few polygons with associated &quot;bonitet&quot; values that were much lower than the lowest possible value defined by the manual. Since these &quot;bonitet&quot; values were probably erroneous, I assigned them as NAs.</p>
</div>
<div id="combined-all-shapefiles-into-unified-file" class="section level5">
<h5>Combined All Shapefiles Into Unified File</h5>
<p>The final step in this processing loop was to combine all individual shapefiles into a unified shapefile - <strong>thus producing an albedo and herbivore density dataset for &quot;young&quot; forest (age 1-30) across the whole of Norway. This dataset has 477906 polygons with 12 albedo estimates each (one for each month).</strong></p>
<hr />
</div>
</div>
<div id="initial-summary" class="section level1 tabset tabset-fade tabset-pills">
<h1>Initial Summary</h1>
<div id="albedo" class="section level2 tabset">
<h2>Albedo</h2>
<div id="overview-1" class="section level3">
<h3>Overview</h3>
<p><img src="https://allyworks.io/moose-albedo/img/init_albedo_moose_density_by_month_smooth.png" /> <img src="https://allyworks.io/moose-albedo/img/init_albedo_boxplot.png" /> <img src="https://allyworks.io/moose-albedo/img/init_albedo_histogram.png" /></p>
</div>
<div id="cut-by-age" class="section level3 tabset tabset-fade tabset-pills">
<h3>Cut by Age</h3>
<div id="january" class="section level4">
<h4>January</h4>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/init_january_age_interval.png" />

</div>
</div>
<div id="april" class="section level4">
<h4>April</h4>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/init_april_age_interval.png" />

</div>
</div>
<div id="july" class="section level4">
<h4>July</h4>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/init_july_age_interval.png" />

</div>
</div>
<div id="october" class="section level4">
<h4>October</h4>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/init_october_age_interval.png" />

</div>
</div>
</div>
<div id="cut-by-latitude" class="section level3 tabset tabset-fade tabset-pills">
<h3>Cut by Latitude</h3>
<div id="january-1" class="section level4">
<h4>January</h4>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/init_albedo_jan_cut_utm33n.png" />

</div>
</div>
<div id="april-1" class="section level4">
<h4>April</h4>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/init_albedo_apr_cut_utm33n.png" />

</div>
</div>
<div id="july-1" class="section level4">
<h4>July</h4>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/init_albedo_jul_cut_utm33n.png" />

</div>
</div>
<div id="october-1" class="section level4">
<h4>October</h4>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/init_albedo_oct_cut_utm33n.png" />

</div>
</div>
</div>
</div>
<div id="shapefile-geometry" class="section level2">
<h2>Shapefile Geometry</h2>
<p>Below is an image which shows the final geometry for the unified shapefile/dataset - borders of remaining polygons (after all filtering steps) appear in black.</p>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/init_geometry_f2.png" />

</div>
</div>
<div id="additional-variables" class="section level2 tabset">
<h2>Additional Variables</h2>
<div id="forest-age" class="section level3">
<h3>Forest Age</h3>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/init_age_histogram.png" />

</div>
</div>
<div id="polygon-area" class="section level3">
<h3>Polygon Area</h3>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/init_area_histogram.png" />

</div>
</div>
<div id="bonitet" class="section level3">
<h3>Bonitet</h3>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/init_bonitet_histogram.png" />

</div>
</div>
<div id="moose-density" class="section level3">
<h3>Moose Density</h3>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/init_moose_density_histogram.png" />

</div>
</div>
<div id="ndvi" class="section level3">
<h3>NDVI</h3>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/init_ndvi_histogram.png" />

</div>
<hr />
</div>
</div>
</div>
<div id="analysis" class="section level1 tabset tabset-fade tabset-pills">
<h1>Analysis</h1>
<div id="correlation-matrix" class="section level2">
<h2>Correlation Matrix</h2>
<p>I created a correlation matrix to investigate possible correlations between continuous explanatory variables (which would ultimately affect the stability of the final model). It looks like there are some strong correlations between the densities of several large herbivores, which will need to be accounted for in the final model.</p>
<div class="figure">
<img src="https://allyworks.io/moose-albedo/img/init_correlation_matrix.png" />

</div>
</div>
<div id="spatial-autocorrelation" class="section level2">
<h2>Spatial Autocorrelation</h2>
<p>One important consideration when working with this dataset will be spatial non-independence of data (i.e. for a given polygon, nearby polygons will be more similar than polygons that are far away). To actually assess whether there is spatial autocorrelation present in the data, I ran a <strong>Moran's I test</strong> using the steps below:</p>
<ul>
<li>Computed a <em>matrix of coordinates</em> for the centroids of each polygon in the dataset</li>
<li>From the matrix of centroids, computed a &quot;K-nearest neighbors matrix&quot; using the knearneigh function - for each centroid, the 4 nearest neighboring centroids were added to the matrix</li>
<li>Created an 'nb' class object from this matrix</li>
<li>Created a 'listw' spatial weights object from this 'nb' object (for use with the moran.mc function below)</li>
<li>Ran a Monte Carlo simulation of Moran's I test for spatial autocorrelation (using data from January and the moran.mc function with 99 simulations)</li>
</ul>
<p>The Moran's I statistic was greater than 0, which indicates that there is spatial autocorrelation in the data. <strong>Therefore, it will be necessary to use some type of model/analysis that can handle spatial autocorrelation</strong>.</p>
<hr />
</div>
</div>
<div id="next-steps" class="section level1">
<h1>Next Steps?</h1>
<div id="geographically-weighted-regression-gwr" class="section level5">
<h5>Geographically Weighted Regression (GWR)?</h5>
<p>I thought it might be interesting to run a GWR (which performs a local regression for each polygon in the dataset). By doing this, I could potentially create a map which shows how the parameter estimate for moose density as a predictor of surface albedo changes across the country (maybe something like below): <img src="https://allyworks.io/moose-albedo/img/gwr_sample.png" /></p>
<p>However, I'm not entirely how we would handle the longitudinal aspect of the data. Additionally, with a dataset of this size, it's impossible to run a GWR using R, so I'll need to use a Python implementation of <a href="https://www.tandfonline.com/doi/abs/10.1080/13658816.2018.1521523?journalCode=tgis20">FastGWR</a>.</p>
</div>
<div id="other-models" class="section level5">
<h5>Other models?</h5>
<p>Initially, I was interested in using either a <strong>spatial lag</strong> or <strong>spatial error</strong> regression model - however, I've run into three issues: (1) it seems that these models can't handle missing data well, (2) the spatial weights matrix used in these models is HUGE (and I'm not sure my computer can handle it), and (3) I'm not sure how to handle the 'longitudinal' aspect of the data - i.e. how do I account for &quot;Month&quot; in the model?</p>
<blockquote>
<p>Do you have any other suggestions on models to use?</p>
</blockquote>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
